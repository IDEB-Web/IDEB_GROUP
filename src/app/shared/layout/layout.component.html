<div class="layout-container">
  <div class="main-content">
    <!-- HEADER -->
    <header class="header" *ngIf="showMainHeader()">
      <button class="menu-btn" (click)="menuOpen = !menuOpen">&#9776;</button>
      <div class="logo-container">
        <img src="assets/LOGO_IDEB.png" alt="LOGO" class="company-logo" (click)="navigateTo('home')"
          style="cursor:pointer;" />
      </div>
      <span class="system-title">
        {{ getHeaderTitle() }}
      </span>
      <div class="user-menu" *ngIf="!currentUser">
        <button class="login-btn" (click)="openLoginModal()">
          <img src="assets/profile.svg" alt="Usuario" class="profile-icon" />
        </button>
      </div>

      <div class="user-menu" *ngIf="currentUser">
        <img [src]="currentUser.photoUrl || 'assets/profile.svg'" alt="Foto usuario" class="profile-icon" />
        <span class="user-name">{{ currentUser.name }}</span>
        <button class="logout-btn" (click)="logout()">Cerrar sesión</button>
      </div>
      <!-- Menú de Configuración -->
      <div class="settings-menu" *ngIf="currentUser">
        <button class="settings-btn" (click)="toggleSettingsMenu()">
          <img src="assets/gear.svg" alt="Configuración" class="settings-icon" />
        </button>
        <ul *ngIf="settingsOpen" class="settings-dropdown" (click)="$event.stopPropagation()">
          <li><a href="#">Perfil</a></li>
          <li><a href="#">Notificaciones</a></li>
          <li><a href="#">Preferencias</a></li>
          <li><a href="#">Seguridad</a></li>
          <li><a href="#">Ayuda</a></li>
        </ul>
      </div>


      <ul *ngIf="menuOpen" class="dropdown-menu" (click)="$event.stopPropagation()">
        <li><a routerLink="/instituto" (click)="closeMenu()">Instituto I-DEB</a></li>
        <li><a routerLink="/automated" (click)="closeMenu()">I-DEB Automated Machines</a></li>
        <li><a routerLink="/seati" (click)="closeMenu()">SEATI-DEB Servicios Especializados</a></li>
      </ul>
    </header>

    <!-- CONTENIDO -->
    <section class="content">
      <!-- Vista inicial (home) -->
      <ng-container *ngIf="isHomeView; else moduleContent">
        <div class="main-buttons-container">
          <div class="top-buttons">
            <button class="main-btn left-btn" (click)="navigateTo('instituto')">
              <span class="main-nav-btn-text">INSTITUTO DE <br> CAPACITACION <br> INDUSTRIAL I-DEB</span>
            </button>
            <button class="main-btn right-btn" (click)="navigateTo('automated')">
              <span class="main-nav-btn-text">I-DEB <br> AUTOMATED<br>MACHINES SERVICES</span>
            </button>
          </div>
          <button class="main-btn center-btn" (click)="navigateTo('seati')">
            <span class="main-nav-btn-text">SEATI-DEB<br>SERVICIOS ESPECIALIZADOS<br>DE ASISTENCIA TECNICA</span>
          </button>
        </div>
      </ng-container>

      <!-- Páginas hijas -->
      <ng-template #moduleContent>
        <router-outlet></router-outlet>
      </ng-template>
    </section>

    <!-- Modal de login -->
    <div class="modal-backdrop" *ngIf="loginModalOpen" (click)="closeLoginModal()"></div>
    <div class="login-modal" *ngIf="loginModalOpen" (click)="$event.stopPropagation()">
      <form [formGroup]="loginForm" (ngSubmit)="login()" class="login-form">

        <img src="assets/LOGO_IDEB.png" alt="LOGO" class="login-logo" />


        <h3>Iniciar Sesión</h3>
        <p *ngIf="loginError" class="error-message">{{ loginError }}</p>


        <label for="email">Correo Electrónico</label>
        <input type="email" id="email" placeholder="Correo Electrónico" formControlName="email" required />

        <label for="password">Contraseña</label>
        <div class="password-container">
          <input type="password" id="password" placeholder="Contraseña" formControlName="password" required />
          <span class="toggle-password"></span>
        </div>


        <button type="submit" class="btn-login" [disabled]="loginForm.invalid">Iniciar Sesión</button>

        <!-- Botón de Google -->
        <div class="google-login">
          <button type="button" class="btn-google" (click)="loginWithGoogle()">
            <img src="assets/IDEB-LOGO-GOOGLE.png" alt="Google" class="google-icon" />
            <span>Iniciar sesión con Google</span>
          </button>
        </div>

        <div class="login-links">
          <p>¿No tienes una cuenta? <a routerLink="/register" (click)="closeLoginModal()">Regístrate aquí</a></p>
          <a href="#">Olvidé mi contraseña</a>
        </div>


        <p class="version">Versión 3.7.4</p>
      </form>
    </div>

    <!-- FOOTER -->
    <app-footer></app-footer>
  </div>
</div>