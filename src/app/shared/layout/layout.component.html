<div class="app-layout-container" [class.tema-oscuro]="authService.isDarkMode">

  <div class="main-content">
    <!-- HEADER -->
    <header class="header" *ngIf="showMainHeader()">
      <button class="menu-btn" (click)="toggleMenu($event)">&#9776;</button>
      <div class="logo-container">
        <img [src]="getLogoUrl()" alt="LOGO" class="company-logo" (click)="navigateTo('home')"
          style="cursor:pointer;" />
      </div>
      <span class="system-title">{{ getHeaderTitle() }}</span>

      <div class="user-menu" *ngIf="!currentUser">
        <button class="login-btn" (click)="openLoginModal()">
          <img src="assets/profile.svg" alt="Usuario" class="profile-icon" />
        </button>
      </div>

      <div class="header-right" *ngIf="currentUser">
        <img [src]="currentUser.photoUrl || 'assets/profile.svg'" alt="Foto usuario" class="profile-icon" />
        <span class="user-name">{{ currentUser.name }}</span>
        <div class="user-dropdown-container">
          <button class="user-dropdown-btn" (click)="toggleUserDropdown($event)">&#x25BE;</button>
          <ul *ngIf="userDropdownOpen" class="user-dropdown" (click)="$event.stopPropagation()">
            <li>
              <div class="user-info">
                <div class="user-name">{{ currentUser.name }}</div>
                <div class="user-role">{{ getUserRoleLabel() }}</div>
              </div>
            </li>
            <li>
              <hr class="user-divider" />
            </li>
            <li>
              <button class="logout-btn" (click)="logout(); userDropdownOpen = false">
                <span style="font-size:1.2em;display:flex;align-items:center;gap:0.4em;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" viewBox="0 0 24 24">
                    <path fill="#fff"
                      d="M16.3 12.75a.75.75 0 0 1 0-1.5h-7.19l2.22-2.22a.75.75 0 1 0-1.06-1.06l-3.5 3.5a.75.75 0 0 0 0 1.06l3.5 3.5a.75.75 0 1 0 1.06-1.06l-2.22-2.22h7.19Z" />
                    <path fill="#fff"
                      d="M20.25 12c0 4.556-3.694 8.25-8.25 8.25A8.25 8.25 0 0 1 3.75 12c0-4.556 3.694-8.25 8.25-8.25A8.25 8.25 0 0 1 20.25 12Zm-1.5 0a6.75 6.75 0 1 0-13.5 0 6.75 6.75 0 0 0 13.5 0Z" />
                  </svg>
                  Cerrar Sesión
                </span>
              </button>
            </li>
          </ul>
        </div>
        <!-- menu de configuracion -->
        <div class="settings-menu">
          <button class="settings-btn" (click)="toggleSettingsMenu($event)">⚙️</button>
          <ul *ngIf="settingsOpen" class="settings-dropdown" (click)="$event.stopPropagation()">

            <li><a [routerLink]="['/perfil']">Perfil</a></li>
            <li><a routerLink="/notificaciones" class="nav-link">Notificaciones</a></li>

            <li><a href="#">Preferencias</a></li>
            <li>
              <a href="#" (click)="toggleTheme($event)">Tema: Claro / Oscuro</a>
            </li>
            <li>
              <a href="#">Tamaño de Letra</a>
              <ul class="font-size-dropdown">
                <li><a href="#" (click)="changeFontSize('small'); settingsOpen=false">Pequeña</a></li>
                <li><a href="#" (click)="changeFontSize('medium'); settingsOpen=false">Media</a></li>
                <li><a href="#" (click)="changeFontSize('large'); settingsOpen=false">Grande</a></li>
                <li><a href="#" (click)="changeFontSize('xlarge'); settingsOpen=false">Extra Grande</a></li>
              </ul>
            </li>

            <li class="accessibility-btn">
              <button (click)="toggleAccessibilityMenu($event)">Accesibilidad</button>
              <ul *ngIf="accessibilityOpen" class="accessibility-submenu">
                <li><button (click)="toggleHighContrast()">Alto Contraste</button></li>
                <li><button (click)="toggleReduceMotion()">Reducir Movimiento</button></li>
                <li><button (click)="toggleEasyRead()">Fácil Lectura</button></li>
              </ul>
            </li>

            <li><a href="#">Seguridad</a></li>
            <li><a href="#">Cambiar Contraseña</a></li>
            <li><a href="#">Gestión de Sesiones</a></li>

            <hr />
            <li><a href="#">Ayuda</a></li>
            <li><a href="#">Acerca de</a></li>
          </ul>
        </div>
        <!--menu desplegable principl-->
      </div>
      <ul *ngIf="menuOpen" class="dropdown-menu" (click)="$event.stopPropagation()">
        <li><a routerLink="/instituto" (click)="closeMenu()">Instituto I-DEB</a></li>
        <li><a routerLink="/automated" (click)="closeMenu()">I-DEB Automated Machines</a></li>
        <li><a routerLink="/seati" (click)="closeMenu()">SEATI-DEB Servicios Especializados</a></li>
        <li *ngIf="isAdmin()"><a routerLink="/admin/usuarios" (click)="closeMenu()">Usuarios Pendientes</a></li>
      </ul>
    </header>

    <input type="file" #logoInput style="display: none;" (change)="onLogoSelected($event)" accept="image/*" />
    <!--boton de regresar-->
    <div class="back-button-container" *ngIf="showBackButton()">
      <button class="back-button" (click)="goBack()" title="Volver atrás">
        &#8592; Volver
      </button>
    </div>
    <!--contenido principal-->
    <section class="content">
      <ng-container *ngIf="isHomeView">
        <div class="main-buttons-container">
          <div class="top-buttons">
            <button class="main-btn left-btn" (click)="navigateTo('instituto')">
              <span class="main-nav-btn-text">INSTITUTO DE <br> CAPACITACION <br> INDUSTRIAL I-DEB</span>
            </button>
            <button class="main-btn right-btn" (click)="navigateTo('automated')">
              <span class="main-nav-btn-text">I-DEB <br> AUTOMATED<br>MACHINES SERVICES</span>
            </button>
          </div>
          <button class="main-btn center-btn" (click)="navigateTo('seati')">
            <span class="main-nav-btn-text">SEATI-DEB<br>SERVICIOS ESPECIALIZADOS<br>DE ASISTENCIA TECNICA</span>
          </button>
        </div>
      </ng-container>
      <router-outlet *ngIf="!isHomeView"></router-outlet>
    </section>
    <!--tarjeta de login -->
    <div class="modal-backdrop" *ngIf="loginModalOpen" (click)="closeLoginModal()"></div>
    <div class="login-modal" *ngIf="loginModalOpen" (click)="$event.stopPropagation()">
      <form [formGroup]="loginForm" (ngSubmit)="login()" class="login-form">
        <img src="assets/LOGO_IDEB.png" alt="LOGO" class="login-logo" />
        <h3>Iniciar Sesión</h3>
        <p *ngIf="loginError" class="error-message">{{ loginError }}</p>

        <label for="email">Correo Electrónico</label>
        <input type="email" id="email" placeholder="Correo Electrónico" formControlName="email" required />

        <label for="password">Contraseña</label>
        <div class="password-container">
          <input type="password" id="password" placeholder="Contraseña" formControlName="password" required />
          <span class="toggle-password"></span>
        </div>

        <button type="submit" class="btn-login" [disabled]="loginForm.invalid">Iniciar Sesión</button>

        <div class="google-login">
          <button type="button" class="btn-google" (click)="loginWithGoogle()">
            <img src="assets/IDEB-LOGO-GOOGLE.png" alt="Google" class="google-icon" />
            <span>Iniciar sesión con Google</span>
          </button>
        </div>

        <div class="login-links">
          <p>
            ¿No tienes una cuenta?
            <a routerLink="/register" (click)="closeLoginModal()">Regístrate aquí</a>
          </p>
          <a routerLink="/auth/forgot-password" (click)="closeLoginModal()">Olvidé mi contraseña</a>
        </div>

        <p class="version">Versión 3.7.4</p>
      </form>
    </div>

    <app-footer></app-footer>
    <app-profile-modal [user]="currentUser" [isOpen]="showProfileModal" (closeModalEvent)="closeProfileModal()">
    </app-profile-modal>
  </div>
</div>